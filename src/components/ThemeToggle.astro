---
import ToggleIcon from "../assets/botontoggle.svg";
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Cambiar tema"
  class="mr-4  border-0 bg-transparent opacity-70 hover:opacity-100 transition-opacity text-[var(--color-accent)] cursor-pointer"
>
  <ToggleIcon class="w-5 h-5" />
</button>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById("theme-toggle");

    if (!toggle) return;

    function getTheme(): string {
      const stored = localStorage.getItem("theme");
      if (stored) return stored;
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    }

    function setTheme(theme: string) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
    }

    // Inicializar
    const currentTheme = getTheme();
    setTheme(currentTheme);

    // Toggle
    toggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme");
      setTheme(current === "dark" ? "light" : "dark");
    });
  }

  // Ejecutar en carga inicial y en navegaci√≥n con View Transitions
  initThemeToggle();
  document.addEventListener("astro:after-swap", initThemeToggle);
</script>
