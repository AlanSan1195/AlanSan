---
import projectData from "../data/projects.json";
import GithubIcon from "../assets/gitHubpixel.svg";

// Importar logos como componentes Astro
import AstroLogo from "../assets/logos-svg/astro.astro";
import ClerkLogo from "../assets/logos-svg/clerk.astro";
import CssLogo from "../assets/logos-svg/css.astro";
import HtmlLogo from "../assets/logos-svg/html.astro";
import JavascriptLogo from "../assets/logos-svg/javascript.astro";
import NetlifyLogo from "../assets/logos-svg/netlify.astro";
import NodeLogo from "../assets/logos-svg/node.astro";
import ReactLogo from "../assets/logos-svg/react.astro";
import SupabaseLogo from "../assets/logos-svg/supabase.astro";
import TailwindLogo from "../assets/logos-svg/tailwind.astro";
import ThreejsLogo from "../assets/logos-svg/threejs.astro";
import VercelLogo from "../assets/logos-svg/vercel.astro";

const logoComponents: Record<string, any> = {
  Astro: AstroLogo,
  Clerk: ClerkLogo,
  CSS: CssLogo,
  HTML: HtmlLogo,
  JavaScript: JavascriptLogo,
  Netlify: NetlifyLogo,
  Node: NodeLogo,
  React: ReactLogo,
  Supabase: SupabaseLogo,
  Tailwind: TailwindLogo,
  Threejs: ThreejsLogo,
  Vercel: VercelLogo,
};

const getLogoKey = (logoPathOrKey: string): string => {
  if (logoPathOrKey.includes("/")) {
    return logoPathOrKey.split("/").pop()?.replace(".svg", "") ?? "";
  }

  return logoPathOrKey;
};

// Obtener los 4 proyectos mÃ¡s recientes ordenados por order
const projects = Object.values(projectData)
  .sort((a, b) => b.order - a.order)
  .slice(2, 6);
---

<section class="w-auto mx-auto mt-8">
  <header class="flex items-center justify-between">
    <h2 class="text-2xl font-alpha text-[var(--color-text)]">Proyectos</h2>
    <a
      href="/proyectos"
      class="inline-flex items-center gap-y-2 text-sm text-[var(--color-text-muted)] hover:text-[var(--color-text)] transition-colors font-alpha"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
      </svg>
    </a>
  </header>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {
      projects.map((project) => (
        <div class="glow-card border-[0.5px] border-[var(--color-border)] bg-transparent transition-all duration-200 no-underline block p-3">
          <div class="flex items-start justify-between mb-3 ">
            <a
              class="group text-base font-alpha text-[var(--color-text)] flex items-center gap-1 m-0 no-underline"
              href={`/${project.id}`}
            >
              {project.title}
              <svg
                class="w-3.5 h-3.5 text-[var(--color-text-muted)] group-hover:text-[var(--color-text)] group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 17L17 7M17 7H7M17 7v10"
                />
              </svg>
            </a>
            <a
              href={project.links.github}
              target="_blank"
              rel="noreferrer"
              class="no-underline text-inherit"
            >
              <GithubIcon class="w-4.5 h-4.5 text-[var(--color-text-secondary)] hover:text-[var(--color-text)] transition-colors" />
            </a>
          </div>
          <div class="flex items-start gap-x-2 mb-3">
            <span class="m-0 p-0">{project.emoji}</span>
            <p class="font-satoshi text-sm text-pretty text-[var(--color-text-muted)] m-0 h-9">{project.subTitle}</p>
          </div>

          <div class="flex flex-wrap items-center gap-2">
            {project.logos?.map((logoPathOrKey: string) => {
              const logoKey = getLogoKey(logoPathOrKey);
              const LogoComponent = logoComponents[logoKey];
              return LogoComponent ? (
                <div class="flex items-center gap-x-2 bg-[var(--color-bg-secondary)] border-[0.5px] border-[var(--color-border)] px-2 py-1">
                  <LogoComponent class="w-4 h-4" />
                  <span class="font-king text-xs text-[var(--color-text-muted)]">{logoKey}</span>
                </div>
              ) : null;
            })}
          </div>
        </div>
      ))
    }
  </div>
</section>

<script>
  // @ts-nocheck
  /**
   * @param {HTMLElement} element
   */
  const applyGlowTracking = (element) => {
    /**
     * @param {number} clientX
     * @param {number} clientY
     */
    const setPointer = (clientX, clientY) => {
      const rect = element.getBoundingClientRect();
      element.style.setProperty("--mx", `${clientX - rect.left}px`);
      element.style.setProperty("--my", `${clientY - rect.top}px`);
      element.style.setProperty("--active", "1");
    };

    element.addEventListener("pointerenter", (event) => {
      setPointer(event.clientX, event.clientY);
    });

    element.addEventListener("pointermove", (event) => {
      setPointer(event.clientX, event.clientY);
    });

    element.addEventListener("pointerleave", () => {
      element.style.setProperty("--active", "0");
    });
  };

  const init = () => {
    document
      .querySelectorAll(".glow-card")
      .forEach((element) =>
        applyGlowTracking(/** @type {HTMLElement} */ (element)),
      );
  };

  init();
  document.addEventListener("astro:page-load", init);
</script>

<style>
  .glow-card {
    position: relative;
    --mx: 50%;
    --my: 50%;
    --active: 0;
    --glow-color: rgba(255, 255, 255, 1);
    --glow-bg: rgba(255, 255, 200, 0.02);
  }

  :global([data-theme="light"]) .glow-card {
    --glow-color: rgba(0, 0, 0, 0.8);
    --glow-bg: rgba(0, 0, 0, 0.03);
  }

  .glow-card::before {
    content: "";
    position: absolute;
    inset: -1px;
    z-index: 10;
    pointer-events: none;
    border-radius: inherit;
    padding: 1.28px;
    background: radial-gradient(
      180px 45px at var(--mx) var(--my),
      var(--glow-color),
      transparent 80%
    );
    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    mask-composite: exclude;
    opacity: var(--active);
    transition: opacity 280ms ease;
  }

  .glow-card::after {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 10;
    pointer-events: none;
    border-radius: inherit;
    background: radial-gradient(
      ellipse 100px 50px at var(--mx) var(--my),
      var(--glow-bg),
      transparent 220%
    );
    opacity: var(--active);
    transition: opacity 280ms ease;
  }
</style>
