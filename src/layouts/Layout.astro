---
import NorthernLights from "../components/NorthernLights.astro";
import Header from "../components/Header.astro";
import Backdrop from "../components/Backdrop.astro";
import Footer from "../components/Footer.astro";
import { ClientRouter } from "astro:transitions";

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: "website" | "article";
  publishedDate?: string;
  modifiedDate?: string;
  jsonLd?: Record<string, unknown>;
}

const {
  title = "Alan San - Desarrollador Frontend & Diseñador Web en Guadalajara",
  description = "Desarrollador frontend y diseñador web en Guadalajara, México. Especializado en React, Astro, JavaScript y experiencias digitales modernas. +2 años de experiencia creando interfaces intuitivas y funcionales.",
  image = "/imagenes/FotoPerfil.webp",
  canonical = Astro.url.href,
  type = "website",
  publishedDate,
  modifiedDate,
  jsonLd,
} = Astro.props;

const siteUrl = "https://alansan.dev";
const fullImageUrl = new URL(image, siteUrl).href;
const currentYear = new Date().getFullYear();

// JSON-LD base para Person (siempre presente)
const personJsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  "@id": `${siteUrl}/#person`,
  "name": "Alan San",
  "alternateName": ["Alan Sandoval", "Alan Sandoval Torres"],
  "givenName": "Alan",
  "familyName": "Sandoval",
  "jobTitle": "Desarrollador Frontend",
  "description": "Desarrollador frontend y diseñador web especializado en crear experiencias digitales modernas con React, Astro y JavaScript.",
  "url": siteUrl,
  "image": {
    "@type": "ImageObject",
    "url": `${siteUrl}/imagenes/FotoPerfil.webp`,
    "width": 400,
    "height": 400
  },
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Guadalajara",
    "addressRegion": "Jalisco",
    "addressCountry": "MX"
  },
  "email": "alansandovalt1@gmail.com",
  "sameAs": [
    "https://github.com/AlanSan1195",
    "https://www.linkedin.com/in/devsan11/",
    "https://www.instagram.com/alanpro._/",
    "https://www.facebook.com/alansandovalk11"
  ],
  "knowsAbout": [
    "JavaScript",
    "TypeScript",
    "React",
    "Astro",
    "Next.js",
    "HTML5",
    "CSS3",
    "Tailwind CSS",
    "GSAP",
    "Three.js",
    "Node.js",
    "Git",
    "Responsive Design",
    "UI/UX Design",
    "Web Performance",
    "SEO",
    "Accesibilidad Web"
  ],
  "worksFor": {
    "@type": "Organization",
    "name": "Freelance"
  }
};

// JSON-LD para WebSite
const websiteJsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": `${siteUrl}/#website`,
  "url": siteUrl,
  "name": "Alan San - Portfolio",
  "description": "Portfolio profesional de Alan San, desarrollador frontend en Guadalajara",
  "publisher": {
    "@id": `${siteUrl}/#person`
  },
  "inLanguage": "es-MX"
};

// JSON-LD para la página actual
const webPageJsonLd = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "@id": canonical,
  "url": canonical,
  "name": title,
  "description": description,
  "isPartOf": {
    "@id": `${siteUrl}/#website`
  },
  "about": {
    "@id": `${siteUrl}/#person`
  },
  "inLanguage": "es-MX",
  ...(publishedDate && { "datePublished": publishedDate }),
  ...(modifiedDate && { "dateModified": modifiedDate })
};

// Combinar JSON-LD
const combinedJsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    personJsonLd,
    websiteJsonLd,
    webPageJsonLd,
    ...(jsonLd ? [jsonLd] : [])
  ]
};
---

<!doctype html>
<html lang="es-MX">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Preload de fuentes críticas -->
    <link
      rel="preload"
      href="/fonts/FRONTEND.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/static.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="author" content="Alan San" />
    <meta name="creator" content="Alan San" />
    <meta name="publisher" content="Alan San" />
    <meta
      name="keywords"
      content="Alan San, Alan Sandoval, desarrollador frontend, desarrollador web, frontend developer, diseñador web, Guadalajara, Jalisco, México, JavaScript, TypeScript, React, Astro, Next.js, Tailwind CSS, GSAP, Three.js, HTML, CSS, programador web, freelance, portfolio, UI designer"
    />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    <meta name="theme-color" content="#161616" />
    <meta name="color-scheme" content="dark" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Geo Tags -->
    <meta name="geo.region" content="MX-JAL" />
    <meta name="geo.placename" content="Guadalajara" />
    <meta name="geo.position" content="20.6597;-103.3496" />
    <meta name="ICBM" content="20.6597, -103.3496" />

    <!-- Google Verification -->
    <meta
      name="google-site-verification"
      content="yVrFQfhfT1U7x9nq2B8UFvR8i3OCOuu7o_yYaojqvm4"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonical} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/logo.svg" />
    <link rel="icon" type="image/png" sizes="16x16" href="/logo.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/logo.svg" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={title} />
    <meta property="og:site_name" content="Alan San - Portfolio" />
    <meta property="og:locale" content="es_MX" />
    {publishedDate && <meta property="article:published_time" content={publishedDate} />}
    {modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@AlanSan86780460" />
    <meta name="twitter:creator" content="@AlanSan86780460" />
    <meta name="twitter:url" content={canonical} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullImageUrl} />
    <meta name="twitter:image:alt" content={title} />

    <!-- Additional SEO -->
    <link rel="me" href="https://github.com/AlanSan1195" />
    <link rel="me" href="https://www.linkedin.com/in/devsan11/" />

    <!-- Structured Data JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify(combinedJsonLd)} />

    <ClientRouter />
  </head>
  <body>
    <Header />
    <NorthernLights />

    <main
      class="flex flex-col justify-center mx-auto items-center max-w-[1500px] relative"
    >
      <slot />
      <Footer />
    </main>
    <Backdrop transition:persist />
  </body>
</html>
<style>
  @import "tailwindcss";
  @theme {
    --font-display: "frontend", "sans-serif";
    --font-static: "static", "sans-serif";
    --font-pixel: "pixel", "sans-serif";
    --font-jet: "jet", "sans-serif";
  }
  @font-face {
    font-family: "frontend";
    src: url(/fonts/FRONTEND.woff2) format("woff2");
    font-display: swap;
  }
  @font-face {
    font-family: "static";
    src: url(/fonts/static.woff2) format("woff2");
    font-display: swap;
  }
  @font-face {
    font-family: "pixel";
    src: url(/fonts/pixel.woff2) format("woff2");
    font-display: swap;
  }
  @font-face {
    font-family: "jet";
    src: url(/fonts/JetBrainsMono-Bold.ttf) format("truetype");
    font-display: swap;
  }

  html,
  body {
    margin: 0px 0px;
    width: 100%;
    height: 100%;
    background-color: rgb(22 22 22);
    color: white;
    color-scheme: dark;
    scrollbar-color: oklch(65.6% 0.241 354.308) rgb(22 22 22);
  }
</style>
